#提高代码可读性 
##表面层次的改进 

代码可读性的高低，就像一篇文章别人看了是否能很快明白其要表达的意思一样。  
首先一段好的代码，应该是让人很容易就看出其要表达的意思的，比如  

	1.return is_string($request) ? getPersonMes($request) : getPersonMes(implode(',',$request));
	
	2.if(is_string($request)){
			$mes = getPersonMes($request);
		}else{
			$tmp = implode(',',$request);
			$mes = getPersonMes($tmp);
		}

两中写法，虽然意思一样，从直观性来说，第二种更好，但第一种写法更具简洁性。能用很少的行数完成所需求是很好的，但是如果代码简洁压缩到别人或者自己再次看的时候需要花更多时间。
	
**减少代码行数是个好目标，但把理解代码所需的时间最小化是一个更好的目标**

### 起名

“把信息装入名字中”包括要选择非常专业的词，并且避免使用“空洞”的词。在起名字时尽量使用一些表现力更强的词语。  
实际操作中有时候会有用到一些不是很明确的词语来作为变量，例如tmp,retval
	
	if($right < $left){
		$tmp = $right;
		$right = $left;
		$left = $tmp;
	}
这种情况下，tmp这个名字很好。这个变量的目的就是临时存储，没有其他职责，它的整个生命周期就在这几行代码之间。所以例如tmp这类名字应只用于短期且临时存在的变量。

**再给变量、函数或者其他的元素命名时，要把它描述得更具体而不是抽象。**  
**为名字附带更多信息**  
**标识变量的任何关键属性，如果需要的话以易读的方式把它加入到名字里。**

起名字时有这么多的信息要涵盖，那么会导致有一个问题，名字会很长，名字越长越难记，在屏幕上占的地方也就越多，也会带来更多的换行。这样反而不利于代码的可读性，所以：
**在小的作用域里可以使用短名字**  
还有一些名字是可以用短名字代替的，例如，string用str，document用doc，evaluation用eval代替，这是种几乎是大家公认且熟知的名字，就可以使用短名子。

**丢掉没用的名字**  
起名字时有时会有一些可有可无的名字出现，DoServeLoop()这个名字完全可以用ServeLoop()来替代。

综合以上起名字应该有一下几点：  

	1.使用专业单词---例如，不用Get,而用Fetch或者Download可能会更好，这由上下文决定。
	2.避免空泛的名字，像tmp除非使用它有特殊理由。
	3.使用具体的名字来更细致地描述事物---ServerCanStart()这个名字就比CanListenOnPort更不清楚。
	4。给变量名带上重要的细节--例如，在值为毫秒的变量后面加上_ms，或者在需要转义的，未处理的变量前加上raw_。
	5.为作用域大的名字采用更长的名字--不要用让人费解的一个或两个字母的名字来命名在几屏之间都可
	见的变量。对于只存在几行之间的变量用短一点的名字更好。
	6.有目的地使用大小写、下划线等---例如，可以在类成员和局部变量后面加上"_"来区分。
	
### 不起被误解的名字
起名字时多想想这个名字是否是可以很直观的被理解的，会不会被别人理解成另外一种意思。
**命名极限最清楚的方式是在要限制的东西前加上max_或者min_。

使用first和last来表示包含的范围（$first="1",$last="10"）
使用begin和end来表示包含/排除范围

给布尔值命名：值为布尔值的变量或函数，要确保返回的true或者false要有明确的意义。
	例如：$read_password = true;  
这有两个截然不同的解释：1.我们需要密码。2已经读取了密码。所以根据上下文，如果是需要密码，可以命名为need_password。

**与使用者的期望相匹配**
有些名字之所以会被误解，是因为用户对他们的含义有先入为主的印象。

**如何权衡多个备选名字**
根据实际情况与上下文，选取一个最直观，最明白的词语作为名字。

	不会误解的名字是最好的名字--阅读你的代码的人应该理解你的本意，并且不会有其他的理解。遗憾的
	是，很多英语单词在用来编程时是多义的，例如filter,length,和limit。在决定使用一个名字前，
	要多想想这个名字是不是会被误解。
	当要定义一个值得上限或下限时，max_和min_是很好的前缀。对于包含的范围，first和last是很好选择。
	对于包含/排除范围，begin和end是最好的选择，因为他们最常用。
	当为布尔值命名时，使用is和has这样的词来明确表示他是个布尔值，避免使用反义的词。
	要小心用户对特定词的期望。例如，用户会期望get()或者size()是轻量的方法。
	
### 审美
**好的代码应当看上去养眼**  
阅读代码，从审美角度讲让人愉悦的代码更容易让人读下去。
三条原则：
1.使用一致的布局，让读者很快就习惯这种风格。  
2.让相似的代码看上去相似。  
3.把相关的代码分组，形成代码块。

**重新安排换行来保持一致和紧凑**
**用方法来整理不规则的东西**
**在需要时使用列对齐**
	
	getUserInfo(1,'' 	,true);
	getUserInfo(2,'page',true);
	getUserInfo(3,'' 	,false);
	
**选择一个有意义的顺序，始终一致地使用它**
很多情况下，代码的顺序不会影响其正确性。但是因为每行代码长短的问题，导致观赏性有所不同。所以，尽可能的在不影响其正确性的情况下，将其更具观赏性的排列出来。

**把声明按块组织起来**
我们的大脑很自然的会按照分组和层次结构来思考，因此你可以通过这样的组织方式来帮助读者快速地理解你的代码。  

**把代码分成“段落”**

**风格一致性**

### 改写什么样的注释
**注释的目的是尽量帮助读者了解得和作者一样多。  
不要为那些从代码本身就能快速推断的事实写注释。  
不要为了注释而注释。  
不要给不好的名字加注释，应该把名字改好。
为代码中的瑕疵写注释**
几种常用标记：
	
	TODO:我还没有处理的事情
	FIXME:已知的无法运行的代码
	HACK:对一个问题不得不采用的比较粗糙的解决方案
	XXX:危险！这里有重要问题
**给常量加注释  
给可能会被误解的代码加上注释  
“全局观”注释  
总结性注释 
克服“作者心里阻滞”**
写出好的注释不容易，但不要因为不好写就不写。

什么地方不需要注释：  
1.能从代码本身中迅速地推断的事实  
2.用来粉饰代码（例如蹩脚的函数名）的“拐杖式注释”--应该把代码改好。

应该记录下来的想法：  
1.对于为什么代码写成这样而不是那样的内在理由（“指导性批注”）。  
2.代码中的缺陷，使用像TODO：或者XXX：这样的标记。  
3.常量背后的故事，为什么是这个值。

站在读者的立场思考：  
1.预料到代码中哪些部分会让读者说：“啊？”并且加上注释。  
2.为普通读者意料之外的行为加上注释。  
3.为普读者意料之外的行为加上注释。  
4.在文件/类的级别上使用“全局观”注释来解释所有的部分是如何一起工作的。  
5.用注释来总结代码块，使读者不至于迷失在细节中。  

### 写出言简意赅的注释
写注释最好把它写的精确--越明确和细致越好。另外，由于注释在屏幕上也要占很多地方，并且需要花更多的时间来读，因此，注释也需要很紧凑。  
**注释应当有很高的信息/空间率**

**避免使用不明确的代词**  
**润色粗糙的句子**
很多情况下，让注释更精确的过程总是伴随着让注释更紧凑。
**精确地描述函数行为**
**用输入/输出例子来说明特别的情况**
**声明代码的意图**
**“具名函数参数”的注释**
**采用信息含量高的词**


	当像“it”和“this”这样的代词可能指代多个事物时，避免使用它们。
	尽量精确地描述函数的行为。
	在注释中用精心挑选的输入/输出例子进行说明。
	声明代码的高层次意图，而非明显的细节。
	用嵌入的注释来解释难以理解的函数参数。
	用含义丰富的词来使注释简洁。
	
	
## 简化循环和逻辑
### 把控制流变得易读
把条件、循环以及其他对控制流的改变做得越“自然”越好。运用一种方式使读者不用停下来重读你的代码。  
**条件语句中参数的顺序**
类似于“<,>”这样的比较时，可以遵循这条原则：
<table>
	<tr>
		<td>比较的左侧</td>
		<td>比较的右侧</td>
	</tr><tr>
		<td>"被询问的"表达式，它的值更倾向于不断变化</td>
		<td>用来做比较的表达式，它的值更倾向于常量</td>
	</tr>
</table>

**if/else语句的顺序**  
1.首先处理正逻辑而不是负逻辑的情况。例如，用if(debug)而不是if(!debug).  
2.先处理掉简单的情况。这种方式可能还会使得if和else在屏幕之内都可见。  
3.先处理有趣的或者是可疑的情况。

**三元运算符的使用**  
相对于追求最小化代码行数，一个更好的度量方法是最小化人们理解它所需的时间。所以，默认情况下都用if/else.三元运算符只有在最简单的情况下使用。

**避免do/while循环**  
do/while的奇怪之处是一个代码块是否会执行是由其后的一个条件决定的。通常来讲，逻辑条件应该出现在他们所“保护”的代码前，这也是if.while和for语句的工作方式。因为通常会从前向后来读代码，这就使得do/while循环有点不自然了。  
while循环会更易读，因为你会先读到所有迭代的条件，然后在读到其中的代码块。但仅仅是为了去掉do/while循环而重复一段代码是有点愚蠢的做法。

**最小化嵌套**  
嵌套很深的代码很难理解。每个嵌套层次都在读者的“思维栈”上又增加了一个条件。当读者见到一个右大括号（}）时，可能很难“出栈”来回忆起它背后的条件是什么。  
嵌套是如何累积而成的？  
当你对代码改动时，从全新的角度审视它，把它作为一个整体来看待。
**通过提前返回来减少嵌套**  
**减少循环内部的嵌套**  

	代码控制流更易读懂的总结：
	1.在写一个比较时（while(bytes_expected>bytes_received)）,把改变的值写在左边并且把更
	稳定的值写在右边更好一些（while(bytes_received<bytes_expected)）。
	2.重新排列if/else语句中的语句块。通常来讲，先处理正确的/简单的/有趣的情况。有时候这些准则
	会冲突，但是当不冲突时，这是要遵循的经验法则。
	3.某些变成结构，像三元运算符，do/while循环，以及goto经常导致代码的可读性变差。最好不要使
	用他们，因为总是有更整洁的代替方式。
	4.嵌套是我代码块需要更加集中精力去理解，每层新的嵌套都需要读者把更多的上下文“压入栈”。应该
	把他们改成更加“线性”的代码来避免深嵌套。
	5.通常来讲提早返回可以减少嵌套并让代码整洁。“保护语句”（在函数顶部处理简单的情况时）尤其重要。

### 拆分超长的表达式
把超长的表达式拆分成更容易理解的小块。  
**用作解释的变量**  
拆分表达式最简单的方法就是引入一个额外的变量，让他来表示一个小一点的子表达式。这个额外的变量有时叫做“解释变量”，因为他可以帮助解释子表达式的含义。  
**总结变量**  
即使一个表达式不需要解释，把它装入一个新变量中仍然有用。我们把它叫做总结变量，它的目的只是用一个短很多的名字来代替一大块代码，这个名字会更容易管理和思考。  
**不要滥用短路逻辑**  
有时候写代码会为了减少代码行数而牺牲代码可读性，把逻辑解析成一段简明的代码，往往别人看到这段得停下来想想，甚至产生迷惑。  
**拆分巨大的语句**
**另一个简化表达式的创意方法**

	拆封表达式的方法：
	1.一个简单的技术是引入“解释变量”来代表较长的子表达式。这种方式有三个好处：
		⑴它把巨大的表达式拆分成小段。
		⑵它通过用简单的名字描述子表达式来让代码文档化。
		⑶它帮助读者识别代码中的主要概念。
	2.德摩根定律来操作逻辑表达式----这个技术有时候可以把布尔表达式用更整洁的方法重写
	
### 变量与可读性
变量的三个问题:  
1.变量越多，就越难全部跟踪他们的动向。  
2.变量的作用域越大，就需要跟踪它的动向越久。  
3.变量改变得越频繁，就越难以跟踪它的当前值。

**减少变量**  
1.减少没有价值的临时变量。  
2.减少中间结果。  
3.减少控制流变量。  
4.缩小变量的作用域。  
操作一个变量的地方越多，就越难确定它的当前值。

	减少变量，即那些妨碍的变量。
	减小每个变量的作用域，越小越好。把变量移到一个最少代码可以看到它的地方。
	只写一次的变量更好。那些只设置一次值得变量是的代码更容易理解。
	
## 重新组织代码
三种组织代码的方法：  
1.抽取出那些与程序主要目的“不相关的子问题”。  
2.重新组织代码使它一次只做一件事情。  
3.先用自然言语描述代码，然后用这个描述来帮助你找更整洁的解决方案。  

### 抽取不相关的子问题
积极地发现并抽取出不相关的子逻辑：  
1.看看某个函数或代码块，问问自己，这段代码高层次的目标是什么。  
2.对于每一行代码，问一下：它是直接为了目标而工作吗？这段代码高层次的目标是什么呢？  
3。如果足够的行数子解决不相关的子问题，抽取代码到独立的函数中。  

自顶向下编程是一种风格，先设计高层次模块和函数，然后根据支持它们的需要来实现低层次函数。
自底向上编程尝试首先预料和解决所有的子问题，然后用这些代码段来建立更高层次的组件。
大多数编程都包含了两者的组合重要的事最终结果：移除并单独解决子问题。

“永远不要安于使用不理想接口”。总是可以创建自己的包装函数来隐藏接口的粗陋细节，让它不再成为阻碍。

**一次只做一件事**  
一个代码块可能初始化对象、清除数据，解析输入，然后应用业务逻辑，所有这些都同时进行。如果所有这些代码都纠缠一起，对于每个“任务”都很难靠其自身来帮助你理解它从哪里开始，到哪结束。

	应该把代码组织得一次只做一件事情

使代码“一次只做一件事”所用的流程：  
1.列出代码所做的所有“任务”。这里的“任务”没有很严格的定义--它可以小得如“确保这个对象有效”、或者含糊得如“遍历树中所有节点”。  
2.尽量把这件任务拆分到不同的函数中，或者至少是代码中不同的段落中。  

在重构代码时，经常又很多做法，一旦你把一些任务分开，代码变得更容易让人思考，你可能会想到重构代码的更好方法。  
例如，一连串if语句需要小心地进去读才能知道每种情况是否都对。在代码段中其实有两个子任务在同时进行：  
	
	var first_half = “Middle-of-Nowhere”;
	if(state && country !== "USA"){
		first_half = state;
	}
	if(city){
		first_half = city;
	}
	if(town){
		first_half = town;
	}
1.遍历一些列变量，找出可以变量中最满意的哪一个。  
2.依据国家是否为“USA”而采用不同的列表。  
可以看出“if USA”的逻辑交织在其他的逻辑中，可以分别处理USA和非USA得情况：
	
	var first_half, second_half;
	if(country === 'USA'){
		first_half = town || city || "Middle-of-Nowhere";
		second_half = state || 'USA';
	}else{
		first_half = town || city || state || 'Middle-of-Nowhere';
		second_half = country || "Planet Earth";
	}

组织代码的简单技巧：一次只做一件事。  
如果你有很难读的代码，尝试把它所做的所有任务列出来。其中一些任务可以很容易地变成单独函数（或类）。其他的可以简单地成为一个函数中的逻辑“段落”。具体如何拆分这些任务没有他们已经分开这个事实那么重要。难的是要准确地描述你的程序所做的这些小事情。

### 把想法变成代码

当把一件复杂的事向别人解释时，那些小细节很容易会让他们迷惑。把一个想法用“自然语言”解释是个很有价值的能力，因为这样其他知识没有你这么渊博的人才可以理解他。这需要把一个想法精炼成最重要的概念。这样做不仅帮助他人理解，而且也帮助你自己把这个想法想得更清晰。  
把代码“展示”给读者时也应使用同样的的技巧。我们接受代码是你解释程序所做事情的主要手段这一观点。所以代码应当用“自然语言”编写。

1.像对着一个同事一样用自然语言描述代码要做什么。  
2.注意描述中所用的关键词和短语。  
3.写出与描述所匹配的代码。  

### 少写代码
最好读的代码就是没有代码 
**质疑和拆分需求**
不是所有的程序都需要运行的快，100%准确，并且能处理所有的输入。如果你真的仔细检查你的需求。有时你可以把它削减成一个简单的问题，只需要较少的代码。

宇宙的自然法则 --- 随着任何坐标系统的增长，把它粘合在一起所需的复杂度增长得更快。

最好的解决办法就是让代码库越小，越轻量级越好，就算项目增长，只需要：  
1.创建越多越好的“工具”代码来减少重复代码。  
2.减少无用代码货没有用的功能。  
3.让项目保持分开的子项目状态。
总得来说，要小心代码的“重量”，然它保持又轻又灵。

通过一下方法避免编写新代码：  
1.从项目中消除不必要的功能，不要过度设计。  
2.重新考虑需求，解决版本最简单的问题，只要能完成工作就行。  
3.经常性地通读标准库的整个API，保持对它们的熟悉程度。  


